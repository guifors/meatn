<div class="restaurant-banner">
  <div class="container">
    <h2 class="banner-headline"><strong> Find your perfect table and join the party</strong></h2>
    <br>
    <div class="inline-form">
      <% if params[:search]%>
      <% search_value_date = params[:search][:date] %>
        <% search_value_city = params[:search][:city] %>
        <% search_value_address = params[:search][:address] %>
        <% search_value_food_type = params[:search][:food_type] %>
      <% end %>
      <div>
        <%= simple_form_for :search, url: bookings_path, method: "GET", html: { class: 'form-inline' } do |f| %>
            <%= f.input :city, input_html: {value: search_value_city, placeholder: "London"}, label: false %>
            <% if params[:date].nil? %>
              <%= f.input :date, input_html: {value: search_value_date, placeholder: "Select date"}, label: false %>
            <% else %>
              <%= f.input :date, input_html: {value: params[:date], placeholder: search_value_date}, label: false %>
            <% end %>
              <%= f.input :address, input_html: {value: search_value_address, placeholder: "Select area" }, label: false %>
          <%= f.input :food_type, input_html: {value: search_value_food_type, placeholder: "Select cuisine"}, label: false, class: "search-elements" %>
          <%= f.submit "Search", class: "btn-flat search-elements" %>
        <% end %>
      </div>
    </div>
    <p class="link-to-booking-page">Can´t find anything that suits? <strong><span><%= link_to "Create your own booking", "/restaurants" %></span></strong></p>
  </div>

</div>
<div class="container">
  <p class="get-current-location border-bottom pt-4 pb-2"><strong>It looks like you are in London. Not correct? </strong><i class="fas fa-map-marker-alt"> <span class="get-current-location-link"><%= link_to "Get current location" %></span></i></p>
  <h5 class="border-bottom pt-3 pb-1"><strong>Popular bookings in this area</strong></h5>
  <div class="row">
    <div class="col-7">
      <div class="card-resto-home pr-2">
        <% @bookings.each do |booking| %>
          <% @user = booking.user %>
          <% @users = booking.users %>

          <%= link_to booking_path(booking) do %>
            <div class="card-restaurant-index restaurant-info link-card">
              <img style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= booking.restaurant.image_url %>')" />
              <div class="card-restaurant-index-infos d-block">
                <div class="d-flex justify-content-between">
                    <h2 class="mt-4"> <%= booking.restaurant.name %> </h2>
                    <p class="mt-4 booking-time"> <%= booking.date.strftime("%H:%M") %> </p>
                </div>
                    <% if booking.restaurant.price == 1 %>
                      <p class="pt-1 pb-1"><%= booking.restaurant.food_type %> · $</p>
                    <% elsif booking.restaurant.price == 2 %>
                      <p class="pt-1 pb-1"><%= booking.restaurant.food_type %> · $$</p>
                    <% else %>
                      <p class="pt-1 pb-1"><%= booking.restaurant.food_type %> · $$$</p>
                    <% end %>
                    <p class="pb-3"> <%= booking.restaurant.short_address %>,  <%= booking.restaurant.city %>  </p>
                    <div class="d-flex justify-content-between">
                      <p>
                        <% blank_stars = 5 - booking.restaurant.user_rating %>
                            <% booking.restaurant.user_rating.times do  %>
                            <i class="fas fa-star filledstars"></i>
                            <% end %>
                            <% blank_stars.times do %>
                            <i class="far fa-star blankstars"></i>
                            <% end %>
                        (<%= booking.restaurant.user_reviews %>)
                      </p>
                      <div class="d-flex">
                        <%= link_to bookings_path, data: {toggle: "modal", target: "#attendeeModal"} do %>
                          <% if booking.user.photo.attached? %>
                              <%= cl_image_tag booking.user.photo.key, class: "ml-1 avatar-bordered-card", alt: "avatar-bordered-card" %>
                          <% else %>
                              <%= cl_image_tag "default_user.png", class: "ml-1 avatar-bordered-card", alt: "avatar-bordered-card" %>
                          <% end %>
                          <% booking.users.each do |user| %>
                            <% if user.photo.attached? %>
                              <%= cl_image_tag user.photo.key, class: "ml-1 avatar-bordered-card", alt: "avatar-bordered-card" %>
                            <% else %>
                              <%= cl_image_tag "default_user.png", class: "ml-1 avatar-bordered-card", alt: "avatar-bordered-card" %>
                            <% end %>
                          <% end %>
                        <% end %>

                      </div>
                    </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="col-5">
      <div class="map-card">
        <div
        id="map"
        style="
        height: 600px;"
        data-markers="<%= @markers.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
        ></div>
      </div>
    </div>
  </div>
</div>
<%= render 'shared/footer' %>
